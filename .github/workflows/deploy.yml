name: Deploy Hexo to GitHub Pages

on:
  push:
    branches: [ master ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      with:
        submodules: recursive
    
    # ä½¿ç”¨ä¸ä½ æœ¬åœ°ç›¸åŒçš„ Node.js 24.11.1
    - name: Setup Node.js 24.11.1
      uses: actions/setup-node@v4
      with:
        node-version: '24.11.1'
        cache: 'npm'
    
    - name: Install dependencies
      run: |
        npm ci
        # æ£€æŸ¥ hexo ç‰ˆæœ¬
        npx hexo version
    
    - name: Build Hexo site
      run: |
        npx hexo clean
        npx hexo generate
        
        # ç¡®ä¿ç”Ÿæˆ .nojekyll æ–‡ä»¶
        touch public/.nojekyll
        
        # åˆ—å‡ºç”Ÿæˆçš„æ–‡ä»¶ç»“æ„
        echo "=== Generated files structure ==="
        find public/ -type f | head -30
        echo "..."
        find public/ -type f | wc -l
    
    - name: Show build details
      run: |
        echo "=== Build Environment ==="
        node --version
        npm --version
        npx hexo version
        echo ""
        echo "=== Public directory size ==="
        du -sh public/
        echo ""
        echo "=== Checking .nojekyll ==="
        ls -la public/.nojekyll || echo ".nojekyll not found"
    
    - name: Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./public
        publish_branch: gh-pages
        force_orphan: true
        commit_message: |
          ğŸš€ Deploy from ${GITHUB_SHA:0:7}
          
          Node.js: 24.11.1
          Built by GitHub Actions